<main class="register-container">
  <div class="card register-card">
    <div class="header">
      <h1>Register</h1>
      <p>Choose your role below and create an account to join our community!</p>
    </div>

    <div class="role-selector">
      <mat-button-toggle-group
        [(ngModel)]="selectedRole"
        name="roleSelector"
        [hideSingleSelectionIndicator]="true"
      >
        <mat-button-toggle value="organizer">
          <mat-icon>event</mat-icon>
          Event Organizer
        </mat-button-toggle>
        <mat-button-toggle value="owner">
          <mat-icon>business</mat-icon>
          Service Provider
        </mat-button-toggle>
      </mat-button-toggle-group>
    </div>

    <div class="content">
      <form [formGroup]="form" (ngSubmit)="onSubmit()">
        <div class="form-sections">
          <div class="left-section">
            <div>
              <mat-form-field appearance="outline" class="primary">
                <mat-label>Email</mat-label>
                <input matInput formControlName="email" type="email" required>
                <mat-error *ngIf="form.get('email')?.invalid">
                  Please enter a valid email
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="primary">
                <mat-label>Password</mat-label>
                <input
                  matInput
                  formControlName="password"
                  [type]="hidePassword ? 'password' : 'text'"
                  required>
                <button
                  type="button"
                  mat-icon-button
                  matSuffix
                  (click)="togglePasswordVisibility('password')">
                  <mat-icon>
                    {{ hidePassword ? 'visibility_off' : 'visibility' }}
                  </mat-icon>
                </button>
                <mat-error *ngIf="form.get('password')?.invalid">
                  Password must contain at least 8 characters, one letter and one number.
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="primary">
                <mat-label>Confirm Password</mat-label>
                <input
                  matInput
                  formControlName="confirmPassword"
                  [type]="hideConfirmPassword ? 'password' : 'text'"
                  required>
                <button
                  type="button"
                  mat-icon-button
                  matSuffix
                  (click)="togglePasswordVisibility('confirmPassword')">
                  <mat-icon>
                    {{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}
                  </mat-icon>
                </button>
                <mat-error *ngIf="form.hasError('confirmPasswordMismatch')">
                  Passwords do not match
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="primary">
                <mat-label>First Name</mat-label>
                <input matInput formControlName="firstName" required>
              </mat-form-field>

              <mat-form-field appearance="outline" class="primary">
                <mat-label>Last Name</mat-label>
                <input matInput formControlName="lastName" required>
              </mat-form-field>

              <div class="file-upload">
                <label>Profile Picture</label>
                <app-image-upload
                  [multiple]="false"
                  [maxFileSize]="2000000"
                  (imagesChanged)="onProfilePictureSelected($event)"
                />
              </div>
            </div>
          </div>

          <div class="vertical-divider"></div>

          <div class="right-section">
            <ng-container *ngIf="selectedRole === 'organizer'">
              <div formGroupName="eventOrganizerFields">
                <mat-form-field appearance="outline" class="primary">
                  <mat-label>Country</mat-label>
                  <input matInput formControlName="country">
                </mat-form-field>

                <mat-form-field appearance="outline" class="primary">
                  <mat-label>City</mat-label>
                  <input matInput formControlName="city">
                </mat-form-field>

                <mat-form-field appearance="outline" class="primary">
                  <mat-label>Address</mat-label>
                  <input matInput formControlName="address">
                </mat-form-field>

                <mat-form-field appearance="outline" class="primary">
                  <mat-label>Phone Number</mat-label>
                  <ngx-mat-input-tel
                    [preferredCountries]="['rs']"
                    [enablePlaceholder]="true"
                    [enableSearch]="true"
                    name="phoneNumber"
                    autocomplete="tel"
                    formControlName="phoneNumber"
                    #phone
                  />
                  <mat-hint>e.g. {{ phone.selectedCountry.placeHolder }}</mat-hint>
                  <mat-error *ngIf="form.get('phoneNumber')?.invalid">
                    Please provide a valid phone number
                  </mat-error>
                </mat-form-field>

              </div>
            </ng-container>

            <ng-container *ngIf="selectedRole === 'owner'">
              <div formGroupName="ownerFields">
                <mat-form-field appearance="outline" class="primary">
                  <mat-label>Company Name</mat-label>
                  <input matInput formControlName="companyName">
                </mat-form-field>

                <mat-form-field appearance="outline" class="primary">
                  <mat-label>Country</mat-label>
                  <input matInput formControlName="country">
                </mat-form-field>

                <mat-form-field appearance="outline" class="primary">
                  <mat-label>City</mat-label>
                  <input matInput formControlName="city">
                </mat-form-field>

                <mat-form-field appearance="outline" class="primary">
                  <mat-label>Company Address</mat-label>
                  <input matInput formControlName="address">
                </mat-form-field>

                <mat-form-field appearance="outline" class="primary">
                  <mat-label>Contact Phone</mat-label>
                  <ngx-mat-input-tel
                    [preferredCountries]="['rs']"
                    [enablePlaceholder]="true"
                    [enableSearch]="true"
                    name="contactPhone"
                    autocomplete="tel"
                    formControlName="contactPhone"
                    #phone
                  />
                  <mat-hint>e.g. {{ phone.selectedCountry.placeHolder }}</mat-hint>
                  <mat-error *ngIf="form.get('contactPhone')?.invalid">
                    Please provide a valid phone number
                  </mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline" class="primary">
                  <mat-label>Description</mat-label>
                  <textarea matInput formControlName="description" rows="4"></textarea>
                </mat-form-field>

                <div class="file-upload">
                  <label>Pictures (optional)</label>
                  <app-image-upload
                    [multiple]="true"
                    [maxFileSize]="2000000"
                    (imagesChanged)="onCompanyPicturesSelected($event)"
                  />
                </div>
              </div>
            </ng-container>
          </div>
        </div>

        <div class="actions">
          <button
            mat-flat-button
            class="primary"
            type="submit"
            [disabled]="form.invalid"
          >
            Register
          </button>
          <a mat-button class="secondary" routerLink="/user/login">
            Already have an account? Login
          </a>
        </div>
      </form>
    </div>
  </div>
</main>
